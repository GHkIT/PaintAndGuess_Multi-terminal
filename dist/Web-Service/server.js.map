{"version":3,"sources":["../../Web-Service/server.js"],"names":["path","require","express","webpack","config","app","server","createServer","io","compiler","keyword","KEYWORD","INDEX","tips","use","static","join","__dirname","noInfo","publicPath","output","get","req","res","sendFile","on","socket","data","broadcast","emit","message","Math","floor","random","length","console","log","sockets","bingo","tip","toLocaleLowerCase","listen","err"],"mappings":"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","file":"server.js","sourcesContent":["var path = require('path');\nvar express = require('express');\nvar webpack = require('webpack');\nvar config = require('./webpack.config');\nvar app = express();\nvar server = require('http').createServer(app);\nvar io = require('socket.io')(server);\nvar compiler = webpack(config);\n\nvar keyword = ['猫', '大象', '飞机', '钱', '炸弹', '猪','牛奶','书'], KEYWORD,INDEX,\n    tips = ['一种猫科动物','体重很大的动物','天上飞的','不一定是万能的','伤害力很大','很胖','喝起来很舒服','精神食粮'];\n\napp.use(express.static(path.join(__dirname, '/')));\n    //use in webpack development mode\napp.use(require('webpack-dev-middleware')(compiler, {\n    noInfo: true,\n    publicPath: config.output.publicPath\n}));\napp.use(require('webpack-hot-middleware')(compiler));\n\n//use in webpack production mode\n//app.use(express.static(__dirname));\n\napp.get('/', function(req, res) {\n    res.sendFile(path.join(__dirname, 'index.html'));\n});\n\n// socket监听的事件\nio.on('connection', function(socket) {\n    /**\n     * 画者事件 drawPath\n     * 传入JSON：data\n     * 例：\n     *  {\n            beginX: 68\n            beginY: 182\n            colorValue: \"red\"\n            deviceHeight: 400\n            deviceWidth: 500\n            endX: 74\n            endY: 181\n            lineValue: 3\n     *  }\n     */\n    socket.on('drawPath', function(data) {\n        /**\n         * 广播事件 showPath\n         * 将画者事件接收的data数据，向连接到socket服务器的客户端(猜者)进行广播\n         * 例：\n         * socket.on('showPath', (data)=>{\n                // 自定义画的方法\n                this.drawing({json});\n            });\n         * \n         */\n        socket.broadcast.emit('showPath', data);\n    });\n\n\n\n    // 监听客户端的socket.send(message)方法\n    socket.on('message', function(message){\n        // 画者生成一个随机的关键字\n        if(message == 'getKeyWord'){\n            INDEX = Math.floor(Math.random() * keyword.length);\n            KEYWORD = keyword[INDEX];\n            // 将生成的关键字发送到画者的客户端\n            socket.emit('keyword', KEYWORD);\n            \n        // 画者清空画布 socket.send('clear')    \n        }else if(message == 'clear'){\n            // 猜者端清空画布\n            console.log('进来了');\n            socket.broadcast.emit('showBoardClearArea');\n            // socket.emit('showBoardClearArea');\n        }else if(message == 'success'){\n            // 猜对后，清空画布，更换词\n            io.sockets.emit('successClearArea');\n        }\n    }); \n    \n    \n    \n    /**\n     * 猜者提交 submit\n     * 传入str: keyword\n     * \n     * this.state.socket.emit('submit', keyword)}\n     */\n    socket.on('submit', function(keyword) {\n        // 标志位\n        var bingo = 0;\n        // 提示\n        var tip = '';\n        // 如果\n        console.log(keyword);\n        if(keyword && KEYWORD){\n            if (KEYWORD.toLocaleLowerCase() == keyword.toLocaleLowerCase()) {\n                console.log('进来了2');\n                bingo = 1;\n            }else{\n                tip = tips[INDEX];\n            }\n        }else{\n            bingo = -1;\n        }\n        console.log(bingo);\n        console.log(tip);\n\n        // 将flag标志位传到连接的客户端\n        socket.emit('answer', {\n            bingo:bingo,\n            tip:tip\n        });\n    });\n\n\n\n    socket.on('disconnect', function() {});\n});\n\nserver.listen(3007, 'localhost', function(err) {\n    if (err) {\n        return console.log(err);\n    }\n    console.log('Listening at http://localhost:3007');\n});\n"]}